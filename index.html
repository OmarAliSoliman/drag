<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    [draggable="true"] {
      user-select: none;
      -moz-user-select: none;
      -webkit-user-select: none;
      -ms-user-select: none;
    }

    ul.moveable {
      list-style: none;
      margin: 0px;
      display: flex;
      padding: 0;
      gap: 10px;
      direction: rtl;
      /* Space between items */
    }

    ul.moveable li {
      margin: 0;
      padding: 0;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: move;
      display: inline-block;
    }

    ul.moveable li img {
      position: relative;
      display: inline-block;
    }

    ul.moveable li img::after {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #ccc;
      content: "";
      opacity: 1;
    }

    ul.moveable li img {
      display: block;
      width: 100px;
      /* Set a fixed size for images */
      height: auto;
      object-fit: contain;
      /* Ensure the image fits within the bounds */
      border-radius: 4px;
    }

    ul.moveable li:hover {
      /* background-color: #eee; */
    }

    @media(max-width: 600px) {
      ul.moveable {
        flex-wrap: wrap;
      }
    }
  </style>
</head>

<body>


  <ul id="items-list" class="moveable">
    <li><input type="hidden" name="arrangement[]" value="146"><img
        src="https://nahr.art4muslim.net/uploads/choices/07xSYaUWtTnYoeQQb0MQZk9SyIC0HW6Fg7UlqWl3.jpg" width="100"></li>
    <li><input type="hidden" name="arrangement[]" value="149"><img
        src="https://nahr.art4muslim.net/uploads/choices/RE1Kv7WTn6ftoNSTqNFeEkpOmpzneYQhjyEIINLN.jpg" width="100"></li>
    <li><input type="hidden" name="arrangement[]" value="145"><img
        src="https://nahr.art4muslim.net/uploads/choices/YL9IbgTOnF2SnuFLyULmDSSoyOTwkPY2HTzL0uQ9.jpg" width="100"></li>
    <li><input type="hidden" name="arrangement[]" value="148"><img
        src="https://nahr.art4muslim.net/uploads/choices/AjR5qOtjM0LgrEw4VONxa28YnHx1ZjhyMEaZCwnS.jpg" width="100"></li>
    <li><input type="hidden" name="arrangement[]" value="154"><img
        src="https://nahr.art4muslim.net/uploads/choices/JrL4vC7bJSm1CID0Ds7p6mCfxurHx4DZbnsaoD9r.jpg" width="100"></li>
    <li><input type="hidden" name="arrangement[]" value="153"><img
        src="https://nahr.art4muslim.net/uploads/choices/OEpHbyrY7vo2qX3x0p6dXE32Ysc52TxsCIdM322l.jpg" width="100"></li>
    <li><input type="hidden" name="arrangement[]" value="147"><img
        src="https://nahr.art4muslim.net/uploads/choices/PxWTZqy2dZrTWb5Ddlnc2nm9v7H6ICphzqYppiw3.jpg" width="100"></li>
    <li><input type="hidden" name="arrangement[]" value="144"><img
        src="https://nahr.art4muslim.net/uploads/choices/BJtshdBBR3i99Qqy5eNfHT9tPLdnKjsMkMBpzh9O.jpg" width="100"></li>
    <li><input type="hidden" name="arrangement[]" value="150"><img
        src="https://nahr.art4muslim.net/uploads/choices/Uq19t16Za9lelRkoqGryMCMhjM592etKKyIUrXwu.jpg" width="100"></li>
    <li><input type="hidden" name="arrangement[]" value="151"><img
        src="https://nahr.art4muslim.net/uploads/choices/VSxuuu6zdArNNnquKFQr3xQBYIg8KHS0q8yRUMrv.jpg" width="100"></li>
  </ul>



  <script>
    let items = document.querySelectorAll('#items-list > li img'); // Select images instead of li elements

    items.forEach(item => {
      item.setAttribute('draggable', true);  // Explicitly set draggable to true for images
      item.addEventListener('dragstart', dragStart);
      item.addEventListener('dragenter', cancelDefault);
      item.addEventListener('dragover', cancelDefault);
      item.addEventListener('drop', dropped);
      item.addEventListener('touchstart', handleTouchStart);  // Added touch start for mobile
      item.addEventListener('touchmove', handleTouchMove);    // Added touch move for mobile
      item.addEventListener('touchend', handleTouchEnd);      // Added touch end for mobile
    });

    // Drag start event handler for desktop
    function dragStart(e) {
      var index = Array.from(e.target.parentNode.parentNode.children).indexOf(e.target.parentNode); // Find the index of the li
      e.dataTransfer.setData('text/plain', index);
      e.target.style.opacity = 0.5; // Make the image slightly transparent during dragging
    }

    // Drop event handler for desktop
    function dropped(e) {
      cancelDefault(e);

      // Get the old and new index
      let oldIndex = e.dataTransfer.getData('text/plain');
      let target = e.target;

      // Check if the target is an image or a li element and set the target to its parent (li element)
      if (target.tagName.toLowerCase() === 'img') {
        target = target.parentNode; // Get the li parent element
      }

      let newIndex = Array.from(target.parentNode.children).indexOf(target);

      // If the drop target is a list item (not a parent)
      if (target.tagName.toLowerCase() === 'li') {
        // Remove dropped item from old location
        let dropped = target.parentNode.children[oldIndex];

        // Remove from DOM
        dropped.remove();

        // Insert dropped item in the new position
        if (newIndex < oldIndex) {
          target.before(dropped);
        } else {
          target.after(dropped);
        }
      }
    }

    // Mobile touch events to handle dragging
    function handleTouchStart(e) {
      e.preventDefault();  // Prevents the default image preview or download
      var index = Array.from(e.target.parentNode.parentNode.children).indexOf(e.target.parentNode);
      e.target.style.opacity = 0.5;  // Make the image slightly transparent
      e.dataTransfer.setData('text/plain', index);  // Store the index of the image for dragging
    }

    function handleTouchMove(e) {
      e.preventDefault();  // Prevents the default image preview or download
      // Here you can handle the movement of the dragged image for mobile
    }

    function handleTouchEnd(e) {
      e.preventDefault();  // Prevents the default image preview or download
      var target = e.target;
      // Perform the drop operation or reset the dragged image opacity
      target.style.opacity = 1; // Reset opacity
      // Insert image into the correct position as in the desktop drop handler
    }

    // Cancel default behavior for dragover and dragenter events
    function cancelDefault(e) {
      e.preventDefault();
      e.stopPropagation();
    }

  </script>
</body>

</html>